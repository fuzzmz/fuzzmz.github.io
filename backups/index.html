
<!DOCTYPE html>
<html lang="en">
<head>
    <script type="text/javascript">
        var host = "fuzz.me.uk";
        if ((host == window.location.host) && (window.location.protocol != "https:"))
            window.location.protocol = "https";
    </script>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta name="author" content="fuzzmz" />
        <meta name="keywords" content="backup,ftp,archive" />
        <meta name="description" content="As I was saying at the end of the last post, locking myself out of the server really made me want to have implemented my backup mechanism sooner, especially considering that at this point in the life of QWERTY (my VPS) there isn’t that much to back up. In ..." />

<!-- Open Graph tags -->
<meta property="og:site_name" content="Fuzzmz | ramblings on tech, life, and randomness by Serban Constantin"/>
<meta property="twitter:site" content="@fuzzmz"/>
<meta property="twitter:creator" content="@fuzzmz"/>
    <meta property="og:type" content="article"/>
    <meta property="og:title" content="Up, up, backup!"/>
    <meta property="og:url" content="https://fuzz.me.uk/backups/"/>
    <meta property="og:description" content="As I was saying at the end of the last post, locking myself out of the server really made me want to have implemented my backup mechanism sooner, especially considering that at this point in the life of QWERTY (my VPS) there isn’t that much to back up. In ..."/>
    <meta property="article:published_time" content="2012-01-20" />
    <meta property="article:section" content="how-to" />
        <meta property="article:tag" content="backup" />
        <meta property="article:tag" content="ftp" />
        <meta property="article:tag" content="archive" />
        <meta property="article:author" content="fuzzmz" />
        <meta property="twitter:card" content="summary" />

    <title>Up, up, backup! - Fuzzmz | ramblings on tech, life, and randomness by Serban Constantin</title>

        <link rel="stylesheet" href="https://fuzz.me.uk/theme/css/bootstrap.sandstone.min.css" type="text/css"/>

    <link href="https://fuzz.me.uk/theme/css/font-awesome.min.css" rel="stylesheet" />
    <link href="https://fuzz.me.uk/theme/css/pygments/colorful.css" rel="stylesheet" />
    
        <link href="https://fuzz.me.uk/theme/css/typogrify.css" rel="stylesheet" />
    <link href="https://fuzz.me.uk/theme/css/pelican-twitchy.min.css" rel="stylesheet" />

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <!-- Feeds -->
</head>
<body data-spy="scroll" data-target="#scrollspy">
    <div id="wrapper">
        <!-- Sidebar -->
        <div id="sidebar-wrapper-small" class="twitchy-background">
            <ul id="accordion-small" class="sidebar-nav sidebar-nav-small">
                <li>
        <a href="https://fuzz.me.uk" title="Fuzzmz | ramblings on tech, life, and randomness by Serban Constantin" class="collapsed">
            <span class="glyphicon glyphicon-home"></span>
        </a>
    </li>
                <li class="nav-divider"></li>
                <li>
        <a href="https://fuzz.me.uk/archives.html" title="Recent Articles" class="collapsed">
            <span class="glyphicon glyphicon-th-list"></span>
        </a>
    </li>
                
                <li class="nav-divider"></li>
                <li id="share-small">
                    <a data-toggle="collapse" data-parent="#accordion-small" href="#collapse-share-small" title="Share" class="collapsed">
                        <i class="fa fa-share-alt padding-small"></i>
                    </a>
                </li>
                <li class="panel anti-panel"><ul id="collapse-share-small" class="collapse ">
                    <li>
                        <a href="https://www.facebook.com/sharer/sharer.php?u=https://fuzz.me.uk/backups/" title="Share via Facebook" target="popup">
                            <i class="fa fa-facebook-square padding-small"></i>
                        </a>
                    </li>
                    <li>
                        <a href="https://plus.google.com/share?url=https://fuzz.me.uk/backups/" title="Share via Google+" target="popup">
                            <i class="fa fa-google-plus padding-small"></i>
                        </a>
                    </li>
                    <li>
                        <a href="https://twitter.com/share" class="twitter-share-button" data-count="vertical" title="Share via Twitter" target="popup">
                            <i class="fa fa-twitter-square padding-small"></i>
                        </a>
                    </li>
                </ul></li>
                <li class="nav-divider"></li>
                <li>
                    <a data-toggle="collapse" data-parent="#accordion-small" href="#collapse-social-small" title="Social" class="collapsed">
                        <i class="fa fa-users padding-small"></i>
                    </a>
                </li>
                <li class="panel anti-panel"><ul id="collapse-social-small" class="collapse ">
                    <li>
                        <a href="https://github.com/fuzzmz" title="GitHub"><i class="fa fa-github-square fa-lg padding-small"></i></a>
                    </li>
                    <li>
                        <a href="https://plus.google.com/+serbanconstantin" title="Google+"><i class="fa fa-google-plus-square fa-lg padding-small"></i></a>
                    </li>
                    <li>
                        <a href="https://feeds.feedburner.com/fuzzmeuk" title="RSS"><i class="fa fa-rss-square fa-lg padding-small"></i></a>
                    </li>
                    <li>
                        <a href="https://twitter.com/fuzzmz" title="Twitter"><i class="fa fa-twitter-square fa-lg padding-small"></i></a>
                    </li>
                </ul></li>
                <li class="nav-divider"></li>
                <li>
        <a href="#" title="Back to top" class="collapsed">
            <span class="fa fa-arrow-up"></span>
        </a>
    </li>
            </ul>
        </div>
        <div id="sidebar-wrapper" class="twitchy-background">
            <ul id="accordion" class="sidebar-nav">
                <li class="sidebar-brand">
                    <a href="https://fuzz.me.uk/">
                            <span class="glyphicon glyphicon-home padding-small"></span>
                            Home
                    </a>
                </li>
                    <li class="nav-divider"></li>
                    <li>
                        <a data-toggle="collapse" data-parent="#accordion" href="#collapse-latest">
                            <span class="glyphicon glyphicon-th-list padding-small"></span>
                            Recent Articles
                        </a>
                    </li>
                    <li class="panel anti-panel"><ul id="collapse-latest" class="sidebar_submenu collapse in">
                        <li class="">
                            <a class="hide-overflow" href="https://fuzz.me.uk/burn-it-all/" title="Burn it all">
                                <i class="fa fa-file-text padding-small"></i>
                                Burn it all
                            </a>
                        </li>
                        <li class="">
                            <a class="hide-overflow" href="https://fuzz.me.uk/https-now-green/" title="Green URL bar">
                                <i class="fa fa-file-text padding-small"></i>
                                Green URL bar
                            </a>
                        </li>
                        <li class="">
                            <a class="hide-overflow" href="https://fuzz.me.uk/making-private-tests-public/" title="Making private tests public">
                                <i class="fa fa-file-text padding-small"></i>
                                Making private tests public
                            </a>
                        </li>
                        <li class="">
                            <a class="hide-overflow" href="https://fuzz.me.uk/google-photos-shared-albums-annoyances/" title="Google Photos Shared Albums annoyances">
                                <i class="fa fa-file-text padding-small"></i>
                                Google Photos Shared Albums annoyances
                            </a>
                        </li>
                        <li class="">
                            <a class="hide-overflow" href="https://fuzz.me.uk/oh-kernel-my-kernel/" title="Oh kernel, my kernel">
                                <i class="fa fa-file-text padding-small"></i>
                                Oh kernel, my kernel
                            </a>
                        </li>
                    <li>
                        <a href="https://fuzz.me.uk/archives.html">
                            <i class="fa fa-arrow-right padding-small"></i>
                            More
                        </a>
                    </li>
                    </ul></li>
                <li class="nav-divider"></li>
                <li id="share">
                    <a data-toggle="collapse" data-parent="#accordion" href="#collapse-share" title="Share" class="collapsed">
                        <i class="fa fa-share-alt padding-small"></i>
                        Share
                    </a>
                </li>
                <li class="panel anti-panel"><ul id="collapse-share" class="sidebar_submenu collapse ">
                    <li>
                        <a href="https://www.facebook.com/sharer/sharer.php?u=https://fuzz.me.uk/backups/" target="popup">
                            <i class="fa fa-facebook-square padding-small"></i>
                            Facebook
                        </a>
                    </li>
                    <li>
                        <a href="https://plus.google.com/share?url=https://fuzz.me.uk/backups/" target="popup">
                            <i class="fa fa-google-plus padding-small"></i>
                            Google+
                        </a>
                    </li>
                    <li>
                        <a href="https://twitter.com/share" class="twitter-share-button" data-count="vertical" target="popup">
                            <i class="fa fa-twitter-square padding-small"></i>
                            Twitter
                        </a>
                    </li>
                </ul></li>
                <li class="nav-divider"></li>
                <li>
                    <a data-toggle="collapse" data-parent="#accordion" href="#collapse-social">
                        <i class="fa fa-users padding-small"></i>
                        Contact
                    </a>
                </li>
                <li class="panel anti-panel"><ul id="collapse-social" class="sidebar_submenu collapse ">
                    <li>
                        <a href="https://github.com/fuzzmz" title="GitHub">
                            <i class="fa fa-github-square fa-lg padding-small"></i>
                            GitHub
                        </a>
                    </li>
                    <li>
                        <a href="https://plus.google.com/+serbanconstantin" title="Google+">
                            <i class="fa fa-google-plus-square fa-lg padding-small"></i>
                            Google+
                        </a>
                    </li>
                    <li>
                        <a href="https://feeds.feedburner.com/fuzzmeuk" title="RSS">
                            <i class="fa fa-rss-square fa-lg padding-small"></i>
                            RSS
                        </a>
                    </li>
                    <li>
                        <a href="https://twitter.com/fuzzmz" title="Twitter">
                            <i class="fa fa-twitter-square fa-lg padding-small"></i>
                            Twitter
                        </a>
                    </li>
                </ul></li>
                
                
                <li class="nav-divider"></li>
                <li>
                    <a data-toggle="collapse" data-parent="#accordion" href="#collapse-categories">
                        <i class="fa fa-folder-open padding-small"></i>
                        Categories
                    </a>
                </li>
                <li class="panel anti-panel"><ul id="collapse-categories" class="sidebar_submenu collapse ">
                    <li >
                        <a href="https://fuzz.me.uk/category/debug.html">
                            <i class="fa fa-folder-open padding-small"></i>
                            debug
                            <span class="badge pull-right categorybadge">14</span>
                        </a>
                    </li>
                    <li class="active">
                        <a href="https://fuzz.me.uk/category/how-to.html">
                            <i class="fa fa-folder-open padding-small"></i>
                            how-to
                            <span class="badge pull-right categorybadge">7</span>
                        </a>
                    </li>
                    <li >
                        <a href="https://fuzz.me.uk/category/misc.html">
                            <i class="fa fa-folder-open padding-small"></i>
                            misc
                            <span class="badge pull-right categorybadge">31</span>
                        </a>
                    </li>
                    <li >
                        <a href="https://fuzz.me.uk/category/ux.html">
                            <i class="fa fa-folder-open padding-small"></i>
                            ux
                            <span class="badge pull-right categorybadge">4</span>
                        </a>
                    </li>
                </ul></li>
                
            </ul>
        </div>
        <!-- /#sidebar-wrapper -->
        <!-- open/close sidebar -->
        <a href="#menu-toggle" class="btn btn-default" id="menu-toggle">
            <span id="right-arrow" class="glyphicon glyphicon-chevron-right"  title="expand sidebar"></span>
            <span id="left-arrow" class="glyphicon glyphicon-chevron-left" title="minimize sidebar"></span>
        </a>
       <!-- /open/close sidebar -->

        <!-- Page Content -->
        <div id="page-content-wrapper">
            <div class="container-fluid">
<section id="content">
    <article>
        <div class="row">
            <div class="col-lg-9">
                <header class="page-header">
                    <h1>
                        <a href="https://fuzz.me.uk/backups/"
                           rel="bookmark"
                           title="Permalink to Up, up, backup!">
                            Up, up,&nbsp;backup!
                        </a>
                        <small>
<div class="post-info">
    <div class="publish-info-block">
        <small>
            <span class="published">
                <i class="fa fa-calendar padding-small"></i><time datetime="2012-01-20T03:38:00+02:00"> 2012-01-20</time>
            </span>
            <span class="category">
                <i class="fa fa-folder-open padding-small"></i><a href="https://fuzz.me.uk/category/how-to.html">how-to</a>
            </span>
            <span class="tags">
                <i class="fa fa-tags padding-small"></i>
                <a href="https://fuzz.me.uk/tag/backup.html">backup</a> /                 <a href="https://fuzz.me.uk/tag/ftp.html">ftp</a> /                 <a href="https://fuzz.me.uk/tag/archive.html">archive</a>            </span>
        </small>
    </div>
</div><!-- /.post-info -->                        </small>
                    </h1>
                </header>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-9">
                <div class="entry-content">
                    <p>As I was saying at the end of the last post, locking myself out of the server really made me want to have implemented my backup mechanism sooner, especially considering that at this point in the life of <span class="caps">QWERTY</span> (my <span class="caps">VPS</span>) there isn&rsquo;t that much to back&nbsp;up.</p>
<p>In short, my backup needs are&nbsp;simple:</p>
<ol>
<li>Archive the important data:<ul>
<li><span class="caps">IRC</span> bouncer&nbsp;logs</li>
<li>git&nbsp;repositories</li>
<li>configuration&nbsp;settings</li>
</ul>
</li>
<li>Upload the archive to a remote&nbsp;server;</li>
<li>Repeat 1. and 2.&nbsp;daily.</li>
</ol>
<hr/>
<h2 id="archiving-the-data">Archiving the&nbsp;data</h2>
<p>This is a really simple bash script which creates a .tar.gz archive of the folders I specify. I could further improve the script by making it do incremental backups instead of creating a new archive each day, but considering that this is a fast and dirty version of it, and that I don&rsquo;t have that much stuff to back up, it&rsquo;ll do for&nbsp;now.</p>
<div class="highlight"><pre><span></span><span class="ch">#!/bin/sh</span>
date
<span class="nb">echo</span> <span class="s2">"############### Backing up files on the system... ###############"</span>

<span class="nv">backupfilename</span><span class="o">=</span>server_file_backup_<span class="sb">`</span>date <span class="s1">'+%Y-%m-%d'</span><span class="sb">`</span>

<span class="nb">echo</span> <span class="s2">"----- Now tar, then zip up all files to be saved -----"</span>
tar cvf /home/backup/<span class="si">${</span><span class="nv">backupfilename</span><span class="si">}</span>.tar /home/logs/* /home/stats/pisg.cfg /home/gugu/.znc/configs/znc.conf /home/repos/*
gzip /home/backup/<span class="si">${</span><span class="nv">backupfilename</span><span class="si">}</span>.tar
rm /home/backup/<span class="si">${</span><span class="nv">backupfilename</span><span class="si">}</span>.tar
chmod <span class="m">755</span> /home/backup/<span class="si">${</span><span class="nv">backupfilename</span><span class="si">}</span>.tar.gz

<span class="nb">echo</span> <span class="s2">"############### Completed backing up system... ###############"</span>
date
</pre></div>
<p>The echo lines aren&rsquo;t really necessary, but I like having them there in case I run the script by hand for debugging&nbsp;purposes.</p>
<p>What it does is create an archive named server_file_backup_$current-date and adds the folders and files specified on the line starting with <em>tar cvf</em>. Well, better said it first creates a tar archive, then it gzips it and deletes the original .tar; this is another point where the script could be improved, but hey, it works <span class="caps">OK</span> right&nbsp;now.</p>
<p>The archive is saved under <strong>/home/backup</strong> and it is given all the rights except the capability for anyone to write to the&nbsp;file.</p>
<p>Then all I have to do is make the script executable&nbsp;with:</p>
<div class="highlight"><pre><span></span>chmod +x archive.sh
</pre></div>
<hr/>
<h2 id="uploading-the-archives">Uploading the&nbsp;archive(s)</h2>
<p>A backup wouldn&rsquo;t really be a backup if it lives on the same system you&rsquo;re doing it on, now would it? Now, there are a couple of ways to move the data out, but I decided to simply <span class="caps">FTP</span> it out to the webserver which hosts my main&nbsp;blog.</p>
<p>I initially tried the script using the built-in ftp utility but didn&rsquo;t manage to get it to work, so I looked around and settled for ncftp; debugging the problem would&rsquo;ve been more interesting and a better learning experience but I wanted to get the backups up and running as soon as possible, so this will be a future exercise on my&nbsp;part.</p>
<p>The script is a simple one which logs in to the remote server using a provided username and password and uploads all archives to a pre-specified&nbsp;directory.</p>
<div class="highlight"><pre><span></span><span class="ch">#!/bin/sh</span>
<span class="nv">USERNAME</span><span class="o">=</span><span class="s2">"ftp_user_name"</span>
<span class="nv">PASSWORD</span><span class="o">=</span><span class="s2">"ftp_password"</span>
<span class="nv">SERVER</span><span class="o">=</span><span class="s2">"ftp_server"</span>

<span class="c1"># local directory to pick up *.tar.gz file</span>
<span class="nv">FILE</span><span class="o">=</span><span class="s2">"/home/backup"</span>

<span class="c1"># remote directory to upload backup</span>
<span class="nv">BACKUPDIR</span><span class="o">=</span><span class="s2">"/back"</span>

<span class="c1"># upload file</span>
ncftp -u<span class="s2">"</span><span class="nv">$USERNAME</span><span class="s2">"</span> -p<span class="s2">"</span><span class="nv">$PASSWORD</span><span class="s2">"</span> <span class="nv">$SERVER</span><span class="s">&lt;&lt;EOF</span>
<span class="s">cd $BACKUPDIR</span>
<span class="s">mput $FILE/*.tar.gz</span>
<span class="s">quit</span>
<span class="s">EOF</span>
</pre></div>
<p>And after running the same <strong>chmod +x</strong> on up.sh, ensuring it&rsquo;s executable, I&rsquo;ve got a nice setup&nbsp;to</p>
<ol>
<li>Create the backup&nbsp;archive;</li>
<li>Upload it to the remote&nbsp;server.</li>
</ol>
<hr/>
<h2 id="the-magic-of-cron">The magic of&nbsp;cron</h2>
<p>Now all I have to do is make sure that the scripts run daily so that in case of something bad happening I don&rsquo;t have a lot of data missing. Of course, nothing really stops me running the scripts more often than that, but it&rsquo;s a nice trade-off between the size of the files and how much new data there is&nbsp;added.</p>
<p>Linux has something very similar to the Windows Task Scheduler called cron; what it does is allows users to schedule jobs (commands or shell scripts) to run periodically at certain times or&nbsp;dates.</p>
<p>In order for my scripts to run periodically I had to add them to the <strong>crontab</strong> file, the configuration file for cron which tells it when the jobs need to be executed. To get to the list all I had to do was&nbsp;run:</p>
<div class="highlight"><pre><span></span>crontab -e
</pre></div>
<p>Now I just needed to add the jobs. I wanted to run the archiving script every night at 1am, and then at 1:30am the upload script. Why the 30 minute gap between the jobs? I want to have a margin of error in case I&rsquo;ll add to the script which makes the archive, or in case files get really large, so that I won&rsquo;t have the upload script try and run while the archive is being&nbsp;created.</p>
<p>Anyway, the code for the jobs&nbsp;is:</p>
<div class="highlight"><pre><span></span>* 1 * * * /home/backup.scripts/archive.sh
30 1 * * * /home/backup.scripts/up.sh
</pre></div>
<p>The first line tells cron that it has to run archive.sh every day at 1am and up.sh at&nbsp;1:30am.</p>
<p>And with this I have a backup system in&nbsp;place.</p>
<hr/>
<h2 id="to-do">To&nbsp;do</h2>
<p>I know that things can be improved, and in no way do I say that this is perfect, but it suits my needs at this point in&nbsp;time.</p>
<p>What can (and will be) improved upon are the&nbsp;following:</p>
<ol>
<li><strong>Making incremental backups</strong> - This would mean that I&rsquo;d set a specific day of the week to be the the full backup day,
                                     when everything gets archived, and then on every other day only the files that changed
                                     get&nbsp;updated.</li>
<li><strong>Use built-in ftp client</strong>  - Go back and check to see the reason why I couldn&rsquo;t get ftp to work properly so that I
                                     had to use ncftp&nbsp;instead.</li>
</ol>
<p>I guess that&rsquo;s about it. In all honesty, if I had ssh access to another server I&rsquo;d just use rsync for the backups, but seeing that I don&rsquo;t, this is the best method that came to&nbsp;mind.</p>
<p>In the next post I&rsquo;ll most likely talk about git and how I&rsquo;ve integrated it with&nbsp;Pelican.</p>
                </div>
                <footer class="text-right">
                    <p>- fuzzmz</p>
                </footer>
    <script data-isso="//discuss.fuzz.me.uk/"
            data-isso-avatar="false"
            src="//discuss.fuzz.me.uk/js/embed.min.js"></script>

    <section id="isso-thread"></section>
            </div>
    <div id="scrollspy">
        <div class="col-lg-3 nav nav-stacked hidden-xs hidden-sm" data-spy="affix" data-offset-top="135">
            <div id="toc"><ul><li><a class="toc-href" href="#" title="Up, up,&nbsp;backup!">Up, up,&nbsp;backup!</a><ul><li><a class="toc-href" href="#archiving-the-data" title="Archiving the&nbsp;data">Archiving the&nbsp;data</a></li><li><a class="toc-href" href="#uploading-the-archives" title="Uploading the&nbsp;archive(s)">Uploading the&nbsp;archive(s)</a></li><li><a class="toc-href" href="#the-magic-of-cron" title="The magic of&nbsp;cron">The magic of&nbsp;cron</a></li><li><a class="toc-href" href="#to-do" title="To&nbsp;do">To&nbsp;do</a></li></ul></li></ul></div>
        </div>
    </div>
        </div>
    </article>
</section>
<footer>
    <hr>
    <div class="row">
        <div class="col-xs-4 text-left">
            <p><small>
                ramblings on tech, life, and randomness by Serban Constantin
            </small></p>
        </div>
        <div class="col-xs-5 text-right">
            <p><small>
                Built by <a href="http://docs.getpelican.com/en/latest">Pelican</a> / <a href="https://github.com/ingwinlu/pelican-twitchy">pelican-twitchy</a>
                &middot;                    &copy; 2016 fuzzmz
            </small></p>
        </div>
    </div>
</footer>            </div>
        </div>
        <!-- /#page-content-wrapper -->
    </div>
    <!-- /#wrapper -->
    <!-- jQuery Version 1.11.2 -->
    <script src="https://fuzz.me.uk/theme/js/jquery-1.11.2.min.js"></script>
    <!-- Bootstrap Core JavaScript -->
    <script src="https://fuzz.me.uk/theme/js/bootstrap.min.js"></script>
    <!-- twitchy Script -->
    <script src="https://fuzz.me.uk/theme/js/pelican_twitchy.min.js"></script>

</body>
</html>