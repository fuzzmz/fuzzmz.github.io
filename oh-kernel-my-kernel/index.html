
<!DOCTYPE html>
<html lang="en">
<head>
    <script type="text/javascript">
        var host = "fuzz.me.uk";
        if ((host == window.location.host) && (window.location.protocol != "https:"))
            window.location.protocol = "https";
    </script>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta name="author" content="fuzzmz" />
        <meta name="keywords" content="Android,kernel,linux" />
        <meta name="description" content="So you’re a geek and get your hands on the newest Android goodness (say, a Nexus 6P or 5X), install a terminal emulator - you’re a geek, remember - and then run uname -r only to be surprised at running a kernel that’s a couple of years old. Why is that?" />

<!-- Open Graph tags -->
<meta property="og:site_name" content="Fuzzmz | ramblings on tech, life, and randomness by Serban Constantin"/>
<meta property="twitter:site" content="@fuzzmz"/>
<meta property="twitter:creator" content="@fuzzmz"/>
    <meta property="og:type" content="article"/>
    <meta property="og:title" content="Oh kernel, my kernel"/>
    <meta property="og:url" content="https://fuzz.me.uk/oh-kernel-my-kernel/"/>
    <meta property="og:description" content="So you’re a geek and get your hands on the newest Android goodness (say, a Nexus 6P or 5X), install a terminal emulator - you’re a geek, remember - and then run uname -r only to be surprised at running a kernel that’s a couple of years old. Why is that?"/>
    <meta property="article:published_time" content="2015-12-10" />
    <meta property="article:section" content="misc" />
        <meta property="article:tag" content="Android" />
        <meta property="article:tag" content="kernel" />
        <meta property="article:tag" content="linux" />
        <meta property="article:author" content="fuzzmz" />
        <meta property="twitter:card" content="summary" />

    <title>Oh kernel, my kernel - Fuzzmz | ramblings on tech, life, and randomness by Serban Constantin</title>

        <link rel="stylesheet" href="https://fuzz.me.uk/theme/css/bootstrap.sandstone.min.css" type="text/css"/>

    <link href="https://fuzz.me.uk/theme/css/font-awesome.min.css" rel="stylesheet" />
    <link href="https://fuzz.me.uk/theme/css/pygments/colorful.css" rel="stylesheet" />
    
        <link href="https://fuzz.me.uk/theme/css/typogrify.css" rel="stylesheet" />
    <link href="https://fuzz.me.uk/theme/css/pelican-twitchy.min.css" rel="stylesheet" />

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <!-- Feeds -->
</head>
<body data-spy="scroll" data-target="#scrollspy">
    <div id="wrapper">
        <!-- Sidebar -->
        <div id="sidebar-wrapper-small" class="twitchy-background">
            <ul id="accordion-small" class="sidebar-nav sidebar-nav-small">
                <li>
        <a href="https://fuzz.me.uk" title="Fuzzmz | ramblings on tech, life, and randomness by Serban Constantin" class="collapsed">
            <span class="glyphicon glyphicon-home"></span>
        </a>
    </li>
                <li class="nav-divider"></li>
                <li>
        <a href="https://fuzz.me.uk/archives.html" title="Recent Articles" class="collapsed">
            <span class="glyphicon glyphicon-th-list"></span>
        </a>
    </li>
                
                <li class="nav-divider"></li>
                <li id="share-small">
                    <a data-toggle="collapse" data-parent="#accordion-small" href="#collapse-share-small" title="Share" class="collapsed">
                        <i class="fa fa-share-alt padding-small"></i>
                    </a>
                </li>
                <li class="panel anti-panel"><ul id="collapse-share-small" class="collapse ">
                    <li>
                        <a href="https://www.facebook.com/sharer/sharer.php?u=https://fuzz.me.uk/oh-kernel-my-kernel/" title="Share via Facebook" target="popup">
                            <i class="fa fa-facebook-square padding-small"></i>
                        </a>
                    </li>
                    <li>
                        <a href="https://plus.google.com/share?url=https://fuzz.me.uk/oh-kernel-my-kernel/" title="Share via Google+" target="popup">
                            <i class="fa fa-google-plus padding-small"></i>
                        </a>
                    </li>
                    <li>
                        <a href="https://twitter.com/share" class="twitter-share-button" data-count="vertical" title="Share via Twitter" target="popup">
                            <i class="fa fa-twitter-square padding-small"></i>
                        </a>
                    </li>
                </ul></li>
                <li class="nav-divider"></li>
                <li>
                    <a data-toggle="collapse" data-parent="#accordion-small" href="#collapse-social-small" title="Social" class="collapsed">
                        <i class="fa fa-users padding-small"></i>
                    </a>
                </li>
                <li class="panel anti-panel"><ul id="collapse-social-small" class="collapse ">
                    <li>
                        <a href="https://github.com/fuzzmz" title="GitHub"><i class="fa fa-github-square fa-lg padding-small"></i></a>
                    </li>
                    <li>
                        <a href="https://plus.google.com/+serbanconstantin" title="Google+"><i class="fa fa-google-plus-square fa-lg padding-small"></i></a>
                    </li>
                    <li>
                        <a href="https://feeds.feedburner.com/fuzzmeuk" title="RSS"><i class="fa fa-rss-square fa-lg padding-small"></i></a>
                    </li>
                    <li>
                        <a href="https://twitter.com/fuzzmz" title="Twitter"><i class="fa fa-twitter-square fa-lg padding-small"></i></a>
                    </li>
                </ul></li>
                <li class="nav-divider"></li>
                <li>
        <a href="#" title="Back to top" class="collapsed">
            <span class="fa fa-arrow-up"></span>
        </a>
    </li>
            </ul>
        </div>
        <div id="sidebar-wrapper" class="twitchy-background">
            <ul id="accordion" class="sidebar-nav">
                <li class="sidebar-brand">
                    <a href="https://fuzz.me.uk/">
                            <span class="glyphicon glyphicon-home padding-small"></span>
                            Home
                    </a>
                </li>
                    <li class="nav-divider"></li>
                    <li>
                        <a data-toggle="collapse" data-parent="#accordion" href="#collapse-latest">
                            <span class="glyphicon glyphicon-th-list padding-small"></span>
                            Recent Articles
                        </a>
                    </li>
                    <li class="panel anti-panel"><ul id="collapse-latest" class="sidebar_submenu collapse in">
                        <li class="">
                            <a class="hide-overflow" href="https://fuzz.me.uk/burn-it-all/" title="Burn it all">
                                <i class="fa fa-file-text padding-small"></i>
                                Burn it all
                            </a>
                        </li>
                        <li class="">
                            <a class="hide-overflow" href="https://fuzz.me.uk/https-now-green/" title="Green URL bar">
                                <i class="fa fa-file-text padding-small"></i>
                                Green URL bar
                            </a>
                        </li>
                        <li class="">
                            <a class="hide-overflow" href="https://fuzz.me.uk/making-private-tests-public/" title="Making private tests public">
                                <i class="fa fa-file-text padding-small"></i>
                                Making private tests public
                            </a>
                        </li>
                        <li class="">
                            <a class="hide-overflow" href="https://fuzz.me.uk/google-photos-shared-albums-annoyances/" title="Google Photos Shared Albums annoyances">
                                <i class="fa fa-file-text padding-small"></i>
                                Google Photos Shared Albums annoyances
                            </a>
                        </li>
                        <li class="active">
                            <a class="hide-overflow" href="https://fuzz.me.uk/oh-kernel-my-kernel/" title="Oh kernel, my kernel">
                                <i class="fa fa-file-text padding-small"></i>
                                Oh kernel, my kernel
                            </a>
                        </li>
                    <li>
                        <a href="https://fuzz.me.uk/archives.html">
                            <i class="fa fa-arrow-right padding-small"></i>
                            More
                        </a>
                    </li>
                    </ul></li>
                <li class="nav-divider"></li>
                <li id="share">
                    <a data-toggle="collapse" data-parent="#accordion" href="#collapse-share" title="Share" class="collapsed">
                        <i class="fa fa-share-alt padding-small"></i>
                        Share
                    </a>
                </li>
                <li class="panel anti-panel"><ul id="collapse-share" class="sidebar_submenu collapse ">
                    <li>
                        <a href="https://www.facebook.com/sharer/sharer.php?u=https://fuzz.me.uk/oh-kernel-my-kernel/" target="popup">
                            <i class="fa fa-facebook-square padding-small"></i>
                            Facebook
                        </a>
                    </li>
                    <li>
                        <a href="https://plus.google.com/share?url=https://fuzz.me.uk/oh-kernel-my-kernel/" target="popup">
                            <i class="fa fa-google-plus padding-small"></i>
                            Google+
                        </a>
                    </li>
                    <li>
                        <a href="https://twitter.com/share" class="twitter-share-button" data-count="vertical" target="popup">
                            <i class="fa fa-twitter-square padding-small"></i>
                            Twitter
                        </a>
                    </li>
                </ul></li>
                <li class="nav-divider"></li>
                <li>
                    <a data-toggle="collapse" data-parent="#accordion" href="#collapse-social">
                        <i class="fa fa-users padding-small"></i>
                        Contact
                    </a>
                </li>
                <li class="panel anti-panel"><ul id="collapse-social" class="sidebar_submenu collapse ">
                    <li>
                        <a href="https://github.com/fuzzmz" title="GitHub">
                            <i class="fa fa-github-square fa-lg padding-small"></i>
                            GitHub
                        </a>
                    </li>
                    <li>
                        <a href="https://plus.google.com/+serbanconstantin" title="Google+">
                            <i class="fa fa-google-plus-square fa-lg padding-small"></i>
                            Google+
                        </a>
                    </li>
                    <li>
                        <a href="https://feeds.feedburner.com/fuzzmeuk" title="RSS">
                            <i class="fa fa-rss-square fa-lg padding-small"></i>
                            RSS
                        </a>
                    </li>
                    <li>
                        <a href="https://twitter.com/fuzzmz" title="Twitter">
                            <i class="fa fa-twitter-square fa-lg padding-small"></i>
                            Twitter
                        </a>
                    </li>
                </ul></li>
                
                
                <li class="nav-divider"></li>
                <li>
                    <a data-toggle="collapse" data-parent="#accordion" href="#collapse-categories">
                        <i class="fa fa-folder-open padding-small"></i>
                        Categories
                    </a>
                </li>
                <li class="panel anti-panel"><ul id="collapse-categories" class="sidebar_submenu collapse ">
                    <li >
                        <a href="https://fuzz.me.uk/category/debug.html">
                            <i class="fa fa-folder-open padding-small"></i>
                            debug
                            <span class="badge pull-right categorybadge">14</span>
                        </a>
                    </li>
                    <li >
                        <a href="https://fuzz.me.uk/category/how-to.html">
                            <i class="fa fa-folder-open padding-small"></i>
                            how-to
                            <span class="badge pull-right categorybadge">7</span>
                        </a>
                    </li>
                    <li class="active">
                        <a href="https://fuzz.me.uk/category/misc.html">
                            <i class="fa fa-folder-open padding-small"></i>
                            misc
                            <span class="badge pull-right categorybadge">31</span>
                        </a>
                    </li>
                    <li >
                        <a href="https://fuzz.me.uk/category/ux.html">
                            <i class="fa fa-folder-open padding-small"></i>
                            ux
                            <span class="badge pull-right categorybadge">4</span>
                        </a>
                    </li>
                </ul></li>
                
            </ul>
        </div>
        <!-- /#sidebar-wrapper -->
        <!-- open/close sidebar -->
        <a href="#menu-toggle" class="btn btn-default" id="menu-toggle">
            <span id="right-arrow" class="glyphicon glyphicon-chevron-right"  title="expand sidebar"></span>
            <span id="left-arrow" class="glyphicon glyphicon-chevron-left" title="minimize sidebar"></span>
        </a>
       <!-- /open/close sidebar -->

        <!-- Page Content -->
        <div id="page-content-wrapper">
            <div class="container-fluid">
<section id="content">
    <article>
        <div class="row">
            <div class="col-lg-9">
                <header class="page-header">
                    <h1>
                        <a href="https://fuzz.me.uk/oh-kernel-my-kernel/"
                           rel="bookmark"
                           title="Permalink to Oh kernel, my kernel">
                            Oh kernel, my&nbsp;kernel
                        </a>
                        <small>
<div class="post-info">
    <div class="publish-info-block">
        <small>
            <span class="published">
                <i class="fa fa-calendar padding-small"></i><time datetime="2015-12-10T00:00:00+02:00"> 2015-12-10</time>
            </span>
            <span class="category">
                <i class="fa fa-folder-open padding-small"></i><a href="https://fuzz.me.uk/category/misc.html">misc</a>
            </span>
            <span class="tags">
                <i class="fa fa-tags padding-small"></i>
                <a href="https://fuzz.me.uk/tag/android.html">Android</a> /                 <a href="https://fuzz.me.uk/tag/kernel.html">kernel</a> /                 <a href="https://fuzz.me.uk/tag/linux.html">linux</a>            </span>
        </small>
    </div>
</div><!-- /.post-info -->                        </small>
                    </h1>
                </header>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-9">
                <div class="entry-content">
                    <h1 id="upstream-fast-and-large-android-slow">Upstream fast and large, Android&nbsp;slow</h1>
<p>One of the most cited reasons for this is that Android kernels still carry a lot of custom patches which are not available in the upstream&nbsp;kernel.</p>
<p>Say that an upstream developer introduces an <span class="caps">API</span> change; the first step he should do after this is to check that all existing code compiles and works without regressions. However, he&rsquo;s not obligated to take custom kernel modules (like grsecurity, rt or Android) into account, nor is he responsible for third party&nbsp;drivers.</p>
<p>As such, all of the workload of bringing in upstream changes to the Android kernel lays solely on Google developers, and considering the fast pace of kernel development this task is time&nbsp;consuming.</p>
<hr/>
<h1 id="except-thats-not-it"><i class="fa fa-exclamation"></i>Except that&rsquo;s not&nbsp;it</h1>
<p>The problem is that all of the above simply isn&rsquo;t that accurate. For example, for an Android device running Linux 3.18, there are only 700 patches to Android-ify your kernel (adding modules like cpufreq_interactive, binder, SElinux fixes, etc.). You can see the list of kernel branches supported <a href="https://android.googlesource.com/kernel/common.git/+refs/" title="Refs - kernel/common.git - Git at Google">here</a> to get an idea on how much, or little, they differ from&nbsp;upstream.</p>
<p>One of the reasons might be that SoC vendor brings up the kernel on a new chip (so Qualcomm for example ensures that everything is working on the <span class="caps">SD808</span>/810). The vendor invests and a lot of time and money in making sure everything is stable. The issue here is that the kernel changes a lot of hands: upstream (Linus) provides the base kernel, Google provides the core Android patches on top of a specific version (3.10, 3.14, 3.18, 4.1), the SoC vendor brings up their chip with their own set of patches, and then the actual device <span class="caps">OEM</span> will apply the final changes on top to support a specific&nbsp;device.</p>
<p>This means that SoC vendors don&rsquo;t really have an incentive to bring new kernels to an existing chip. Also note that the development time from when a SoC starts getting worked on and when it&rsquo;s released is pretty long, so your kernel might have actually been not that old when it was selected. It&rsquo;s much easier from a SoC vendor perspective to deal with a new kernel when you&rsquo;re working on bringup for a new SoC. Likewise, even if the SoC vendor upgrades a kernel, the <span class="caps">OEM</span> would have to pick that up, rebase their device-specific patches on top o it, then go through all the testing and bug fixing that&nbsp;entails.</p>
<p>Realistically that won&rsquo;t happen though, as the SoC vendor is already doing bringup on the next generation of chips, and the <span class="caps">OEM</span> is working on their next&nbsp;devices.</p>
<hr/>
<h1 id="does-it-matter-though">Does it matter&nbsp;though?</h1>
<p>Well, it doesn&rsquo;t really matter if you&rsquo;re running 3.10 when upstream is at 4.4. If you&rsquo;re on a desktop and there are bugfixes or new drivers that improve some piece of hardware in your system, great, a new kernel might improve your life significantly. For your phone though, the kernel has been developed specifically for your device because the hardware isn&rsquo;t&nbsp;interchangeable.</p>
<p>If there are better drivers or bugfixes from 4.4, they&rsquo;ve probably been backported to your device on 3.10 - and yes, those will come in with your standard OTAs. You don&rsquo;t need a full kernel version bump to take advantage of&nbsp;those.</p>
<p>In fact you don&rsquo;t want a full kernel version bump because all of your device and SoC specific code can break in mysterious ways. Watch as some mmc refactoring upstream randomly breaks your wifi driver! Missed one armv8 patch? Boom, random <span class="caps">SIMD</span> register corruption that causes programs to randomly segfault. People are especially sensitive to kernel stability on their phones, so the kernels need to be rock solid. Backporting patches to a kernel the SoC vendor has spent a lot of time on making stable is always the safer&nbsp;route.</p>
<hr/>
<h1 id="but-what-about-pcs">But what about&nbsp;PCs?</h1>
<p>The only reason that this is agnostic to Android devices, and not say, desktop <span class="caps">PC</span>&rsquo;s, is because of how drivers/modules are implemented on&nbsp;Android.</p>
<p>Because there is no standardized bootloader on Android, the kernel cannot go about detecting hardware on the platform, and drivers need to be baked into the kernel itself (and thus, loses modularity). This is why it&rsquo;s such an intensive process to upgrade the kernel, as drivers are statically written in, rather than dynamically being&nbsp;linked.</p>
<p>In short, this would be much less of a problem if there were a standardized bootloader, and easy hardware detection in Android Kernel. Once that happens, dynamic linking of modules could be implemented, and much less customization would need to be done to the kernel&nbsp;itself.</p>
<p>In theory, implementing dynamic linking would also be the gateway for Google to provide universal updates to Android devices. It is because of these deep, inflexible changes that Google cannot even begin to push universal&nbsp;updates.</p>
<hr/>
<h1 id="read-more">Read&nbsp;more</h1>
<p>If you&rsquo;ve reached this point and still want more, then you can read <a href="https://lwn.net/Articles/662147/" title="Running a mainline kernel on a cellphone">Running a mainline kernel on a cellphone</a> by Jonathan Corbet on the strugles and fun you&rsquo;d have to face in having the latest and&nbsp;greatest.</p>
                </div>
                <footer class="text-right">
                    <p>- fuzzmz</p>
                </footer>
    <script data-isso="//discuss.fuzz.me.uk/"
            data-isso-avatar="false"
            src="//discuss.fuzz.me.uk/js/embed.min.js"></script>

    <section id="isso-thread"></section>
            </div>
    <div id="scrollspy">
        <div class="col-lg-3 nav nav-stacked hidden-xs hidden-sm" data-spy="affix" data-offset-top="135">
            <div id="toc"><ul><li><a class="toc-href" href="#" title="Oh kernel, my&nbsp;kernel">Oh kernel, my&nbsp;kernel</a><ul><li><a class="toc-href" href="#upstream-fast-and-large-android-slow" title="Upstream fast and large, Android&nbsp;slow">Upstream fast and large, Android&nbsp;slow</a></li><li><a class="toc-href" href="#except-thats-not-it" title="Except that&rsquo;s not&nbsp;it">Except that&rsquo;s not&nbsp;it</a></li><li><a class="toc-href" href="#does-it-matter-though" title="Does it matter&nbsp;though?">Does it matter&nbsp;though?</a></li><li><a class="toc-href" href="#but-what-about-pcs" title="But what about&nbsp;PCs?">But what about&nbsp;PCs?</a></li><li><a class="toc-href" href="#read-more" title="Read&nbsp;more">Read&nbsp;more</a></li></ul></li></ul></div>
        </div>
    </div>
        </div>
    </article>
</section>
<footer>
    <hr>
    <div class="row">
        <div class="col-xs-4 text-left">
            <p><small>
                ramblings on tech, life, and randomness by Serban Constantin
            </small></p>
        </div>
        <div class="col-xs-5 text-right">
            <p><small>
                Built by <a href="http://docs.getpelican.com/en/latest">Pelican</a> / <a href="https://github.com/ingwinlu/pelican-twitchy">pelican-twitchy</a>
                &middot;                    &copy; 2016 fuzzmz
            </small></p>
        </div>
    </div>
</footer>            </div>
        </div>
        <!-- /#page-content-wrapper -->
    </div>
    <!-- /#wrapper -->
    <!-- jQuery Version 1.11.2 -->
    <script src="https://fuzz.me.uk/theme/js/jquery-1.11.2.min.js"></script>
    <!-- Bootstrap Core JavaScript -->
    <script src="https://fuzz.me.uk/theme/js/bootstrap.min.js"></script>
    <!-- twitchy Script -->
    <script src="https://fuzz.me.uk/theme/js/pelican_twitchy.min.js"></script>

</body>
</html>